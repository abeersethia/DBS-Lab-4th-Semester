--5.7
SELECT e.NAME
FROM EMP e
JOIN WORK_EXP we1 ON e.EMPCODE = we1.EMPCODE
JOIN WORK_EXP we2 ON e.EMPCODE = we2.EMPCODE
WHERE we1.prjid = 'P1'
GROUP BY e.empcode, e.name
HAVING MAX(we1.work_experience) > COALESCE(MAX(CASE WHEN we2.prjid = 'P2' THEN we2.work_experience END), 0);

SELECT E.NAME
FROM EMP E
WHERE EMPCODE IN (
SELECT DISTINCT EMPCODE FROM
WORK_EXP 
WHERE PRJID = 'P1' 
AND
WORK_EXPERIENCE > (
SELECT MAX(WORK_EXPERIENCE)
FROM WORK_EXP
WHERE PRJID = 'P2'
));


--5.8
Select e.Name from EMP e
Join WORK_EXP w on e.empcode = w.empcode
Where w.prjid in (Select prjid from work_exp where empcode = 100) and clientid in (Select clientid from work_exp where empcode = 100);

SELECT NAME 
FROM EMP
WHERE EMPCODE IN (
SELECT DISTINCT EMPCODE
FROM WORK_EXP WHERE PRJID IN (
SELECT PRJID FROM WORK_EXP WHERE EMPCODE = 100) OR CLIENTID IN (SELECT CLIENTID FROM WORK_EXP WHERE EMPCODE = 100));

--5.9
SELECT DISTINCT e.Name from EMP e
JOIN WORK_EXP w on e.empcode = w.empcode
WHERE w.prjid NOT IN (Select prjid from work_exp where empcode = 106);

--5.10
SELECT DISTINCT p.PRJ_NAME from PRJ_DETAILS p
JOIN work_exp w on p.prjid = w.prjid
JOIN emp e on w.empcode = w.empcode
where p.BUDGET_ALLOCATED > (Select SUM(SALARY) from EMP where e.empcode = w.empcode);

--5.11
SELECT p.PRJ_NAME, COUNT(DISTINCT w.EMPCODE) 
FROM PRJ_DETAILS p 
JOIN WORK_EXP w ON p.prjid = w.prjid 
WHERE RATING IN ('A', 'B') 
GROUP BY p.PRJ_NAME 
ORDER BY COUNT(DISTINCT w.EMPCODE) DESC;

--5.12
SELECT p.PRJ_NAME FROM PRJ_DETAILS p
JOIN WORK_EXP w ON p.prjid = w.prjid
GROUP BY p.PRJ_NAME
HAVING COUNT(DISTINCT w.EMPCODE) > 2;

--5.13
SELECT e.NAME, COUNT(d.DEP_NAME) as NUM_DEPENDENTS
FROM EMP e
LEFT JOIN FAMILY_DEPENDENTS d ON e.EMPCODE = d.EMPNO
GROUP BY e.NAME;

--5.14
SELECT TO_CHAR(POLICYDATE, 'YYYY') AS YEAR, SUM(PREMIUM) AS TOTAL_PREMIUM
FROM MEDICAL_POLICY
GROUP BY TO_CHAR(POLICYDATE, 'YYYY');

--5.15
WITH EMPLOYEE_SKILL_EXPERIENCE AS (
  SELECT EMPNO, SUM(SKILL_EXPERIENCE) AS TOTAL_EXPERIENCE
  FROM EMP_SKILL
  GROUP BY EMPNO
)
SELECT E.NAME
FROM EMP E
JOIN EMPLOYEE_SKILL_EXPERIENCE ESE ON E.EMPCODE = ESE.EMPNO
WHERE ESE.TOTAL_EXPERIENCE > 20;

--5.16
CREATE TABLE EMP_PRJ AS
SELECT E.NAME AS Emp_Name, P.BUDGET_ALLOCATED AS Budget, P.PRJ_NAME AS Project_Name
FROM EMP E
JOIN WORK_EXP w on e.empcode = w.empcode
JOIN PRJ_DETAILS p ON w.prjid = p.prjid
WHERE E.EMPCODE = 110;

--5.17
UPDATE EMP
SET SALARY = CASE
              WHEN DESIGNATION = 'PROJECT LEADER' THEN SALARY * 1.1
              WHEN DESIGNATION = 'DEVELOPER' THEN SALARY * 1.05
              ELSE SALARY
             END;

--5.18
CREATE VIEW EMP_SKILL_EXPERIENCE AS
SELECT E.NAME, S.SKILLNAME, ES.SKILL_EXPERIENCE
FROM EMP E
JOIN EMP_SKILL ES ON E.EMPCODE = ES.EMPNO
JOIN SKILL S ON ES.SKILLID = S.SKILLID
WHERE ES.SKILL_EXPERIENCE > 20;

UPDATE EMP_SKILL
SET SKILL_EXPERIENCE = 25
WHERE EMPNO = 102 AND SKILLID = 'S4';

--5.19
CREATE VIEW EMP_DESIGNATION AS
SELECT EMPCODE, NAME, SALARY
FROM EMP
WHERE DESIGNATION IN ('DEVELOPER', 'PROJECT LEADER');

UPDATE EMP
SET SALARY = SALARY * 1.1
WHERE EMPCODE = 101;

--5.20
SELECT NAME, 
    (SELECT COUNT(*) 
     FROM PRJ_DETAILS 
     WHERE EMPCODE = EMP.EMPCODE) AS NUM_PROJECTS
FROM EMP;










